<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VERITAS TERMINAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=JetBrains+Mono:wght@300;500&display=swap" rel="stylesheet">
    <style>
        :root { --blue: #00d4ff; --red: #ff2a6d; --green: #05ffa1; --bg: #0a0b10; }
        body { background: var(--bg); color: #e0e0e0; font-family: 'JetBrains+Mono', monospace; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; }
        .header { padding: 40px; text-align: center; width: 100%; }
        h1 { font-family: 'Orbitron', sans-serif; color: var(--blue); letter-spacing: 5px; margin: 0; text-shadow: 0 0 15px var(--blue); }
        .api-status { margin-top: 10px; font-size: 0.8em; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: #444; }
        .container { max-width: 1000px; width: 95%; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; }
        .card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; backdrop-filter: blur(10px); }
        textarea, input { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; margin-bottom: 10px; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; border: none; border-radius: 6px; font-family: 'Orbitron'; cursor: pointer; background: #9d44ff; color: #fff; text-transform: uppercase; transition: 0.3s; }
        button:hover { background: #b066ff; transform: scale(1.02); }
        .entropy-val { font-size: 4em; font-family: 'Orbitron'; text-align: center; margin: 20px 0; color: #fff; }
        .progress { width: 100%; height: 20px; background: #1a1a1a; border-radius: 10px; overflow: hidden; border: 1px solid #333; }
        .fill { width: 0%; height: 100%; background: var(--blue); transition: 1s ease-out; }
        .verdict { margin-top: 20px; padding: 10px; text-align: center; border-radius: 6px; font-weight: bold; display: none; }
        .metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; font-size: 0.8em; }
        .m-box { background: #111; padding: 10px; border-radius: 4px; text-align: center; border: 1px solid #222; }
    </style>
</head>
<body>
    <div class="header">
        <h1>VERITAS TERMINAL</h1>
        <div class="api-status">
            <div id="statusDot" class="dot"></div>
            <span id="statusText">CHECKING CONNECTION...</span>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <h3>üì• DATA INPUT</h3>
            <input type="text" id="urlInput" placeholder="Enter URL...">
            <textarea id="textInput" rows="10" placeholder="Paste your text here..."></textarea>
            <button id="analyzeBtn" onclick="analyze()">üîç ANALYZE</button>
        </div>

        <div class="card">
            <h3>üëÅÔ∏è THE WITNESS</h3>
            <div id="entropyDisplay" class="entropy-val">---</div>
            <div class="progress"><div id="fill" class="fill"></div></div>
            <div id="verdict" class="verdict"></div>
            <div class="metrics">
                <div class="m-box">CHARS<br><span id="mChars" style="color:var(--blue)">0</span></div>
                <div class="m-box">WORDS<br><span id="mWords" style="color:var(--blue)">0</span></div>
                <div class="m-box">UNIQUE<br><span id="mUnique" style="color:var(--blue)">0</span></div>
            </div>
        </div>
    </div>

    <script>
        const API = '/api';

        // 1. –°—Ç–∞—Ç—É—Å –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
        async function checkStatus() {
            const d = document.getElementById('statusDot');
            const t = document.getElementById('statusText');
            try {
                const r = await fetch(API);
                const data = await r.json();
                if(data.status === 'online') {
                    d.style.background = '#05ffa1';
                    d.style.boxShadow = '0 0 10px #05ffa1';
                    t.textContent = 'SYSTEM ONLINE';
                    t.style.color = '#05ffa1';
                }
            } catch(e) {
                t.textContent = 'SYSTEM OFFLINE';
                t.style.color = '#ff2a6d';
            }
        }

        // 2. –†–æ–∑—É–º–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞ (–í—ñ–∫—ñ–ø–µ–¥—ñ—è –±—ñ–ª—å—à–µ –Ω–µ —Ö–∞–æ—Å)
        function calculateEntropy(text) {
            const words = text.toLowerCase()
                .replace(/[0-9]/g, '') 
                .replace(/[^–∞-—è—ñ—ó—î“ëa-z\s]/g, ' ')
                .split(/\s+/)
                .filter(w => w.length > 3);

            if (words.length < 10) return 0.45;

            const counts = {};
            words.forEach(w => counts[w] = (counts[w] || 0) + 1);

            let ent = 0;
            for (let w in counts) {
                let p = counts[w] / words.length;
                ent -= p * Math.log2(p);
            }

            // –ö–æ—Ä–µ–∫—Ü—ñ—è –®—É–∫–∞—á–∞: –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—ñ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–≤–∏
            const ideal = Math.log2(words.length) * 0.85; 
            return Math.min(ent / ideal, 1).toFixed(3);
        }

        // 3. –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è
        async function analyze() {
            const btn = document.getElementById('analyzeBtn');
            const txt = document.getElementById('textInput').value;
            const url = document.getElementById('urlInput').value;
            
            btn.disabled = true;
            btn.textContent = 'PROCESSING...';

            try {
                let content = txt;
                if(url) {
                    const res = await fetch(`${API}?url=${encodeURIComponent(url)}`);
                    const data = await res.json();
                    content = data.content || txt;
                }

                if(!content || content.length < 20) throw new Error("Need more data");

                const score = calculateEntropy(content);
                updateUI(Number(score), content);
            } catch(e) {
                alert("ERR: " + e.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'üîç ANALYZE';
            }
        }

        function updateUI(val, text) {
            const display = document.getElementById('entropyDisplay');
            const fill = document.getElementById('fill');
            const verd = document.getElementById('verdict');
            
            display.textContent = val.toFixed(3);
            fill.style.width = (val * 100) + '%';

            // –ú–µ—Ç—Ä–∏–∫–∏
            document.getElementById('mChars').textContent = text.length;
            document.getElementById('mWords').textContent = text.split(/\s+/).length;
            document.getElementById('mUnique').textContent = new Set(text.toLowerCase().match(/[–∞-—è—ñ—ó—î“ëa-z]{4,}/g)).size;

            let c, l;
            if(val < 0.6) { c = '#05ffa1'; l = 'üü¢ –°–ò–°–¢–ï–ú–ù–ò–ô –ü–û–†–Ø–î–û–ö'; }
            else if(val < 0.8) { c = '#ffcc00'; l = 'üü° –°–ö–õ–ê–î–ù–ê –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø'; }
            else { c = '#ff2a6d'; l = 'üî¥ –ö–†–ò–¢–ò–ß–ù–ò–ô –•–ê–û–°'; }

            display.style.color = c;
            fill.style.background = c;
            verd.textContent = l;
            verd.style.color = c;
            verd.style.border = `1px solid ${c}`;
            verd.style.display = 'block';
        }

        window.onload = checkStatus;
    </script>
</body>
</html>
